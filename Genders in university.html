<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Gender Share — Donut with Year Slider</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif}
    #vis{max-width:900px;margin:24px auto;padding:8px}
    .vega-bindings,.vega-bindings label,.vega-bindings .vega-bind-name{color:#fff}
  </style>
</head>
<body>
<div id="vis"></div>
<script>
const RAW_CSV = "https://raw.githubusercontent.com/amaron66/data_visualisation2/main/gender_by_year.csv";

const spec={
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "title":{"text":"Gender Share of University Commencements","subtitle":"Use the slider to choose a year","anchor":"start","fontSize":20,"subtitleFontSize":13},
  "data":{"url":RAW_CSV,"format":{"type":"csv"}},
  "transform":[
    {"calculate":"toNumber(datum.Year)","as":"YearNum"},
    {"calculate":"toNumber(datum.Commencements)","as":"CommNum"},
    {"filter":"isValid(datum.YearNum) && isValid(datum.CommNum)"},
    {"filter":"datum.Category !== 'Total'"},
    {"filter":"datum.YearNum == Years"},
    {"aggregate":[{"op":"sum","field":"CommNum","as":"Count"}],"groupby":["Category"]},
    {"joinaggregate":[{"op":"sum","field":"Count","as":"Total"}]},
    {"calculate":"datum.Count/datum.Total","as":"Share"},
    {"calculate":"datum.Category + ' — ' + format(datum.Count, ',d') + ' (' + format(datum.Share, '.1%') + ')'", "as":"SliceLabel"}
  ],
  "layer":[
    {"height":430,"width":720,"mark":{"type":"arc","innerRadius":110,"outerRadius":200,"stroke":"#fff"},
     "encoding":{
       "theta":{"field":"Count","type":"quantitative"},
       "color":{"field":"Category","type":"nominal","title":"Category",
         "scale":{"domain":["Female","Male","Other"],"range":["#f8b4d9","#93c5fd","#9ca3af"]}},
       "order":{"field":"Category","sort":["Female","Other","Male"]}
     }},
    {"transform":[{"filter":"datum.Category === 'Other'"}],
     "mark":{"type":"text","fontSize":12,"fontWeight":"600"},
     "encoding":{"theta":{"field":"Count","type":"quantitative"},"radius":{"value":162},"text":{"field":"SliceLabel"},"color":{"value":"#374151"},"detail":{"field":"Category"}}},
    {"transform":[{"filter":"datum.Category === 'Male'"}],
     "mark":{"type":"text","fontSize":13,"fontWeight":"700"},
     "encoding":{"text":{"field":"SliceLabel"},"x":{"value":40},"y":{"value":210},"align":{"value":"right"},"color":{"value":"#1e40af"}}},
    {"transform":[{"filter":"datum.Category === 'Female'"}],
     "mark":{"type":"text","fontSize":13,"fontWeight":"700"},
     "encoding":{"text":{"field":"SliceLabel"},"x":{"value":380},"y":{"value":210},"align":{"value":"left"},"color":{"value":"#9d174d"}}},
    {"mark":{"type":"text","fontSize":30,"fontWeight":"700","align":"center"},
     "encoding":{"text":{"expr":"toString(Years)"},"x":{"value":210},"y":{"value":190}}},
    {"mark":{"type":"text","fontSize":12,"fill":"#6b7280","align":"center"},
     "encoding":{"text":{"value":"Total Commencements"},"x":{"value":210},"y":{"value":218}}},
    {"mark":{"type":"text","fontSize":18,"fontWeight":"700","align":"center"},
     "encoding":{"text":{"aggregate":"sum","field":"Count","format":",d"},"x":{"value":210},"y":{"value":240}}}
  ],
  "params":[{"name":"Years","value":2024,"bind":{"input":"range","min":2017,"max":2024,"step":1}}],
  "config":{"legend":{"orient":"top","labelLimit":300},"axis":{"labelFont":"inherit","titleFont":"inherit"},"view":{"stroke":null}}
};
vegaEmbed("#vis",spec,{actions:false});
</script>
</body>
</html>
